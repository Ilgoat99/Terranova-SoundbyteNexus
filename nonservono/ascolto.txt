<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualizza Brani e Album Spotify</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>

    <h1>Visualizza Brani e Album Spotify</h1>

    <button onclick="autorizzaSpotify()">Autorizza con Spotify</button>
    
    <div id="info-spotify">
        <!-- Le informazioni di Spotify verranno visualizzate qui -->
    </div>

    <div id="brani">
        <h2>Brani:</h2>
        <ul id="lista-brani"></ul>
    </div>

    <div id="album">
        <h2>Album:</h2>
        <ul id="lista-album"></ul>
    </div>

    <script>
        const clientId = 'bcef94d787dc4b9a96d6a84aa5ee8202';
        const redirectUri = 'LA_TUA_URI_DI_REINDIRIZZAMENTO'; // Configurala nel Pannello Sviluppatori di Spotify
        const scopes = 'user-read-private user-read-email user-library-read'; // Aggiungi gli scope necessari per la visualizzazione dei brani e degli album

        function autorizzaSpotify() {
            const urlAutorizzazione = `https://accounts.spotify.com/authorize?client_id=${clientId}&response_type=token&redirect_uri=${encodeURIComponent(redirectUri)}&scope=${encodeURIComponent(scopes)}`;
            window.location.href = urlAutorizzazione;
        }

        function gestisciAutorizzazione() {
            const parametri = new URLSearchParams(window.location.hash.substring(1));
            const accessToken = parametri.get('access_token');
            
            if (accessToken) {
                ottieniDatiSpotify(accessToken);
                visualizzaBrani(accessToken);
                visualizzaAlbum(accessToken);
            }
        }

        function ottieniDatiSpotify(accessToken) {
            fetch('https://api.spotify.com/v1/me', {
                headers: {
                    'Authorization': `Bearer ${accessToken}`
                }
            })
            .then(response => response.json())
            .then(data => {
                const infoSpotify = document.getElementById('info-spotify');
                infoSpotify.innerHTML = `<p>Utente Spotify: ${data.display_name}</p>`;
            })
            .catch(error => console.error('Errore nel recupero dei dati da Spotify API', error));
        }

        function visualizzaBrani(accessToken) {
            fetch('https://api.spotify.com/v1/me/tracks', {
                headers: {
                    'Authorization': `Bearer ${accessToken}`
                }
            })
            .then(response => response.json())
            .then(data => {
                const listaBrani = document.getElementById('lista-brani');
                data.items.forEach(item => {
                    const nomeBrano = item.track.name;
                    const artista = item.track.artists.map(artist => artist.name).join(', ');
                    const listItem = document.createElement('li');
                    listItem.textContent = `${nomeBrano} - ${artista}`;
                    listaBrani.appendChild(listItem);
                });
            })
            .catch(error => console.error('Errore nel recupero dei brani da Spotify API', error));
        }

        function visualizzaAlbum(accessToken) {
            fetch('https://api.spotify.com/v1/me/albums', {
                headers: {
                    'Authorization': `Bearer ${accessToken}`
                }
            })
            .then(response => response.json())
            .then(data => {
                const listaAlbum = document.getElementById('lista-album');
                data.items.forEach(item => {
                    const nomeAlbum = item.album.name;
                    const artista = item.album.artists.map(artist => artist.name).join(', ');
                    const listItem = document.createElement('li');
                    listItem.textContent = `${nomeAlbum} - ${artista}`;
                    listaAlbum.appendChild(listItem);
                });
            })
            .catch(error => console.error('Errore nel recupero degli album da Spotify API', error));
        }

        // Chiamata per gestire l'autorizzazione al caricamento della pagina
        gestisciAutorizzazione();
    </script>

</body>
</html>