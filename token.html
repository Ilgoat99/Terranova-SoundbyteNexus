<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Spotify Player</title>
</head>
<body>
  <h1>Spotify Player</h1>
  <button onclick="authorizeSpotify()">Authorize on Spotify</button>
  <button onclick="getTrackPreview()">Get Track Preview</button>
  <div id="previewPlayer"></div>

  <script>
    const clientId = 'bcef94d787dc4b9a96d6a84aa5ee8202';
    const redirectUri = 'http://localhost/Terranova-SoundbyteNexus/token.html'; // Update with your redirect URI

    let accessToken = '';

    function authorizeSpotify() {
      const scopes = 'user-read-private user-read-email';
      const authorizeUrl = `https://accounts.spotify.com/authorize?client_id=${clientId}&response_type=token&redirect_uri=${encodeURIComponent(redirectUri)}&scope=${encodeURIComponent(scopes)}`;

      window.location.href = authorizeUrl;
    }

    function getAccessToken() {
      const hashParams = window.location.hash.substring(1).split('&');
      for (let i = 0; i < hashParams.length; i++) {
        const [key, value] = hashParams[i].split('=');
        if (key === 'access_token') {
          accessToken = value;
          break;
        }
      }
    }

    function getTrackPreview() {
      if (!accessToken) {
        console.error('Access token not available. Please authorize on Spotify first.');
        return;
      }

      const trackId = 'https://open.spotify.com/intl-it/track/1K9qAxGT4cWUicf2OezSen?si=e1161ca5789f4936'; // Replace with an actual Spotify track ID

      fetch(`https://api.spotify.com/v1/tracks/${trackId}`, {
        headers: {
          'Authorization': `Bearer ${accessToken}`
        }
      })
      .then(response => response.json())
      .then(data => {
        const previewUrl = data.preview_url;
        if (previewUrl) {
          const audioPlayer = document.getElementById('previewPlayer');
          audioPlayer.innerHTML = `<audio controls><source src="${previewUrl}" type="audio/mp3"></audio>`;
        } else {
          console.error('No preview available for this track.');
        }
      })
      .catch(error => console.error('Error fetching track:', error));
    }

    window.onload = function() {
      getAccessToken();
    };
  </script>
</body>
</html>
